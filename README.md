# 项目自动化流程（GitHub Actions）说明

本项目利用自动化流程管理三个核心任务，旨在确保数据的时效性、生成以及关键数据列表的维护。

## ⚙️ 流程总览

| 文件名 | 流程名称 | 触发方式 | 核心功能 | 
 | ----- | ----- | ----- | ----- | 
| 流程 2 | **定期时间任务** | 定期排程 (每 8 小时 35 分) + 手动触发 | 周期性地从外部来源获取并格式化节点配置信息。 | 
| 流程 4 | **数据生成与时间标记** | 手动触发 | 运行特定环境的脚本生成网络数据，并添加时间戳后推送到目标位置。 | 
| 流程 5 | **节点列表聚合与维护** | 手动触发 | 对目标文件中的数据块进行清理、更新和结构化放置。 | 

## 🚀 详细流程分析

### 1. 定期时间任务 (周期性数据采集与格式化)

该流程的核心是通过网络请求获取远程内容，并对内容进行初步的格式化处理。

**触发频率：**

* **自动排程：** **每隔 8 小时 35 分** 自动运行一次。

* **手动触发：** 支持按需启动。

**主要步骤及流程描述：**

1. **环境准备与时区配置：** 准备运行环境，并设定记录时间所使用的时区。

2. **时间记录：** 记录本次流程开始的精确时间。

3. **内容获取与预处理（核心逻辑）：**

   * 从预先配置的外部数据源地址（如 URL A 和 URL B）获取原始数据。

   * 执行文本清理操作，**移除数据中包含的所有非必要格式信息**（例如网页标签）。

   * 将清理后的纯文本内容保存到临时文件。

4. **数据更新：**

   * 读取上一步生成的临时文件。

   * 通过自定义处理逻辑，从纯文本中识别、提取和结构化有效的配置信息。

   * 最终将合格的数据列表更新到项目的数据文件中。

### 2. 数据生成与时间标记 (环境驱动的数据创建)

该流程通过运行特定的自动化环境脚本来生成数据，并为生成结果添加版本标记后进行发布。

**触发方式：**

* **手动触发**，用于按需生成新数据。

**主要步骤及流程描述：**

1. **目标文件准备：** 检出流程中定义的外部存储库（目标仓库），以便修改其中的目标文件。

2. **依赖环境配置：** 配置特定的运行时环境（如 Node 环境），并安装自动化脚本所需的依赖库。

3. **运行数据生成脚本：**

   * 执行核心脚本。该脚本负责驱动自动化程序，模拟复杂的交互操作或数据处理流程，生成所需的网络地址数据。

   * **输出：** 脚本运行结果被写入到临时数据文件。

4. **添加版本标记：**

   * 获取当前时间并将其格式化为版本注释行。

   * 将此版本标记添加到数据内容之前，然后**覆盖**目标文件。

5. **提交与发布：**

   * 配置发布身份。

   * 将修改后的文件提交到版本控制中，并推送到目标仓库。

### 3. 节点列表聚合与维护 (数据块清理与结构化)

此流程是一个精密的内部数据维护步骤，用于在目标文件中替换和重新排序特定的数据块，确保最新数据始终位于文件首部。

**触发方式：**

* **手动触发**。

**主要步骤及流程描述：**

1. **文件准备与工具安装：** 检出目标存储库，并准备所需的数据处理工具。

2. **核心处理 (数据块维护)：**

   * **定义数据边界：** 识别用于界定旧数据块的起始和结束标记。

   * **清理旧块：** 利用文本处理命令，从目标文件中**删除**由这些标记界定的旧数据块，并将文件的其余内容存入临时文件。

   * **生成新数据：** 运行内部校验和生成脚本，产生最新的数据列表。

   * **聚合更新（关键）：**

     * 检查是否有新数据产生。

     * 如果存在新数据，则将新数据块（包含标记）与之前清理后的文件内容进行**拼接合并**。

     * **拼接顺序：** 新数据块始终被放置在文件内容的**最顶部**，以确保数据的可见性。

     * 将重构后的文件覆盖原目标文件。

3. **提交与发布：** 将更新后的文件推送到目标仓库。

## 🔒 依赖与配置

### 敏感配置信息 (Secrets)

以下敏感配置信息必须在平台配置中设置，供“定期时间任务”流程用于访问外部数据源：

* `URL A`：用于获取第一类节点内容的地址。

* `URL B`：用于获取第二类节点内容的地址。

### 流程变量 (Env)

流程 4 和 5 依赖以下配置变量：

* `目标仓库路径`：指定数据发布的目标仓库。

* `目标文件夹`：指定目标文件在仓库中的存放路径。